/*! EmotionalHub 2014-11-26 */
var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},emola;!function(a){var b=function(){function a(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),this.r=a,this.g=b,this.b=c,this.a=d}return a.prototype.move=function(a){this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a},a}();a.Color=b;var c=function(){function a(a,b){this.x=a,this.y=b}return a.prototype.move=function(a){this.x=a.x,this.y=a.y},a.prototype.add=function(a){this.x+=a.x,this.y+=a.y},a}();a.Point=c;var d=function(){function a(a,b,c){this.point=a,this.size=b,this.color=c}return a.prototype.move=function(a,b,c){this.point.x=a.x,this.point.y=a.y,this.size.width=b.width,this.size.height=b.height,this.color.r=c.r,this.color.g=c.g,this.color.b=c.b},a.prototype.draw=function(a){a.drawRect(this)},a}();a.Rect=d;var e=function(){function a(a,b){this.width=a,this.height=b}return a.prototype.move=function(a,b){this.width=a,this.height=b},a}();a.Size=e;var f=function(){function a(a,b,c){this.text=a,this.point=b,this.color=c}return a.prototype.draw=function(a){a.drawText(this)},a}();a.Text=f;var g=function(){function a(a,b,c){this.point=a,this.width=b,this.height=c}return a.prototype.move=function(a,b,c){this.point.move(a),this.width=b,this.height=c},a}();a.Figure=g;var h=function(a){function b(b,c,d){a.call(this,b,2*c,2*c),this.radius=c,this.color=d}return __extends(b,a),b.prototype.move=function(a,b,c){this.point.x=a.x,this.point.y=a.y,this.radius=b,this.color.r=c.r,this.color.g=c.g,this.color.b=c.b,this.color.a=c.a},b.prototype.draw=function(a){a.drawCircle(this)},b.prototype.isMet=function(a){return this.point.x-this.radius<=a.x&&a.x<=this.point.x+this.radius&&this.point.y-this.radius<=a.y&&a.y<=this.point.y+this.radius?!0:!1},b}(g);a.Circle=h;var i=function(){function a(a,b){this.from=a,this.to=b}return a.prototype.draw=function(a){a.drawLine(this)},a}();a.Line=i;var j=function(){function a(a){this.context=a,this.width=a.canvas.width,this.height=a.canvas.height,this.offsetLeft=a.canvas.offsetLeft,this.offsetTop=a.canvas.offsetTop}return a.prototype.drawCircle=function(a){this.context.beginPath(),this.context.fillStyle="rgba("+a.color.r+" ,"+a.color.g+" ,"+a.color.b+" ,"+a.color.a+")",this.context.arc(a.point.x,a.point.y,a.radius,0,2*Math.PI,!1),this.context.fill()},a.prototype.drawRect=function(a){this.context.fillStyle="rgb("+a.color.r+" ,"+a.color.g+" ,"+a.color.b+")",this.context.fillRect(a.point.x,a.point.y,a.size.width,a.size.height)},a.prototype.clear=function(){var a=this.context.canvas.clientWidth,b=this.context.canvas.clientHeight;this.context.clearRect(0,0,a,b)},a.prototype.drawLine=function(a){this.context.beginPath(),this.context.moveTo(a.from.x,a.from.y),this.context.lineTo(a.to.x,a.to.y),this.context.stroke()},a.prototype.drawText=function(a){this.context.fillStyle="rgb("+a.color.r+" ,"+a.color.g+" ,"+a.color.b+")",this.context.fillText(a.text,a.point.x,a.point.y)},a}();a.ContextWrapper=j}(emola||(emola={}));var emola;!function(a){var b=function(){function a(a){this.outer=a,this.dict={}}return a.prototype.update=function(a,b){this.dict[a]=b},a.prototype.get=function(a){return this.dict[a]},a.prototype.find=function(a){if(null===this.outer&&!this.dict[a])throw"symbol:"+a+" is not defined.";return this.dict[a]?this:this.outer.find(a)},a}();a.DictEnv=b;var c=function(){function a(a,b,c){this.args=a,this.expList=b,this.env=c}return a.prototype.evalSyntax=function(){return this.expList.evalSyntax(this.env)},a}();a.Fn=c;var d=function(){function a(a){this.list=a}return a.prototype.evalSyntax=function(a){return this.list.evalSyntax(a)},a}();a.Quote=d;var e=function(){function a(a){this.parent=a,this.children=[],this.token=null}return a.prototype.addChildren=function(a){this.children.push(a)},a}();a.Node=e;var f=function(){function a(a,b){"undefined"==typeof b&&(b=null),this.type=a,this.value=b}return a.isAtom=function(b){return b instanceof a},a.getAtoms=function(){return[a.FN,a.IF,a.DEF,a.DEFN,a.DO,a.SEND,a.LET,a.QUOTE,a.EVAL,a.PLUS,a.MINUS,a.DIV,a.MUL,a.EQUAL,a.GREATER,a.LESS,a.GREATEREQUAL,a.LESSEQUAL,a.DRAW,a.POINT,a.COLOR,a.CIRCLE,a.CLEAR]},a.isAtomToken=function(b){return a.getAtoms().indexOf(b)>=0},a.prototype.equalToType=function(a){return this.type===a},a.prototype.evalSyntax=function(b){switch(this.type){case a.TRUE:return!0;case a.FALSE:return!1;case a.STR:return this.value;case a.NUMBER:return Number(this.value);case a.VAR:if(b.find(this.value)){var c=b.find(this.value).get(this.value);return c.evalSyntax?c.evalSyntax(b):c}throw"target key of environment is not found.";default:console.log(this.type)}},a.FN="fn",a.IF="if",a.DEF="def",a.DEFN="defn",a.DO="do",a.SEND="send",a.VAR="var",a.LET="let",a.QUOTE="quote",a.EVAL="evalSyntax",a.TRUE="true",a.FALSE="false",a.STR="str",a.NUMBER="number",a.PLUS="+",a.MINUS="-",a.DIV="/",a.MUL="*",a.EQUAL="=",a.GREATER=">",a.LESS="<",a.GREATEREQUAL=">=",a.LESSEQUAL="<=",a.DRAW="draw",a.POINT="point",a.COLOR="color",a.CIRCLE="circle",a.CLEAR="clear",a}();a.Atom=f}(emola||(emola={}));var emola;!function(a){function b(a,b){var d=c(b);return G.drawingManager.getListObject(d,a)}function c(b){var c=b.pageX,d=b.pageY,e=b.target.getBoundingClientRect(),f=c-e.left,g=d-e.top;return new a.Point(f,g)}var d;d={};var e=function(){function b(b,c,d){"undefined"==typeof c&&(c=null),"undefined"==typeof d&&(d=null),this.list=b,this.radius=50,this.theta=0,this.nodeColor=new a.Color(255,255,51),this.leafColor=new a.Color(102,102,102),this.listColor=new a.Color(50,50,50,.2),this.parent=c,this.point=d}return b.prototype.push=function(a){return this.list.push(a)},b.prototype.remove=function(a){for(var c in this.list)this.list[c]==a&&this.list.splice(c,1),this.list[c]instanceof b&&this.list[c].remove(a)},b.prototype.rotate=function(a){this.theta+=a;for(var c=0;c<this.list.length;c++)this.list[c]instanceof b&&this.list[c].rotate(a)},b.prototype.pop=function(){return this.list.pop()},b.prototype.draw=function(c){for(var d=new a.Circle(this.point,b.NODE_RADIUS,this.nodeColor),e=0;e<this.list.length;e++){this.theta+=2*Math.PI/this.list.length;var f=new a.Point(this.point.x+this.radius*Math.cos(this.theta),this.point.y+this.radius*Math.sin(this.theta));if(this.list[e]instanceof b)f=new a.Point(this.point.x+3*this.radius*Math.cos(this.theta),this.point.y+3*this.radius*Math.sin(this.theta)),this.list[e].point=f,this.list[e].draw(c);else{var g=new a.Circle(f,b.LEAF_RADIUS,this.leafColor);g.draw(c);var h;h=this.list[e].value?this.list[e].value:this.list[e].type,h=new a.Text(h,f,new a.Color(200,200,200)),h.draw(c)}}new a.Circle(this.point,this.radius,this.listColor).draw(c),d.draw(c)},b.prototype.isMet=function(a){return this.point.x-b.NODE_RADIUS<=a.x&&a.x<=this.point.x+b.NODE_RADIUS&&this.point.y-b.NODE_RADIUS<=a.y&&a.y<=this.point.y+b.NODE_RADIUS?!0:!1},b.prototype.getListObject=function(a){if(this.isMet(a))return this;for(var c in this.list){var d=this.list[c];if(d instanceof b&&d.getListObject(a))return d}return null},b.prototype.add=function(a){this.list.push(a)},b.NODE_RADIUS=20,b.LEAF_RADIUS=15,b}();a.List=e;var f=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.evalSyntax=function(b){var c=this.list[1],d=this.list[2],e=this.list[3];return new a.Circle(c.evalSyntax(b),d.evalSyntax(b),e.evalSyntax(b))},c}(e),g=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(){return G.graphicContext.clear(),G.drawingManager.clear(),null},b}(e),h=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.evalSyntax=function(b){return this.assert(),new a.Color(this.list[1].evalSyntax(b),this.list[2].evalSyntax(b),this.list[3].evalSyntax(b))},c.prototype.assert=function(){if(void 0===this.list[1]||void 0===this.list[2]||void 0===this.list[3]||this.list.length>4)throw"color arguments are illegal."},c}(e),i=function(b){function c(c,d,e){b.call(this,c,d,e),this.listColor=new a.Color(0,255,0,.2)}return __extends(c,b),c.prototype.evalSyntax=function(a){this.assert();var b=this.list[1].value,c=this.list[2].evalSyntax(a);return a.update(b,c),null},c.prototype.assert=function(){if(3!==this.list.length)throw new Error("InvalidArgumentException");if(this.list[1].type!==a.Atom.VAR)throw new Error("InvalidAtomTypeException")},c}(e),j=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.evalSyntax=function(b){this.assert();var c=this.list[1],d=this.list[2].list,e=this.list[3];return b.update(c.value,new a.Fn(d,e,new a.DictEnv(b))),null},c.prototype.assert=function(){if(4!==this.list.length)throw new Error("InvalidArgumentException")},c}(e),k=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){for(var b=1,c=1;c<this.list.length;c++)1===c?b=this.list[c].evalSyntax(a):b/=this.list[c].evalSyntax(a);return b},b}(e),l=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){var b=this.list.slice(1),c=b.map(function(b){return b.evalSyntax(a)});return c[c.length-1]},b}(e);a.DoList=l;var m=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){var b=this.list[1].evalSyntax(a);return G.drawingManager.add(b),b},b}(e);a.DrawList=m;var n=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){return this.list[1].evalSyntax(a)===this.list[2].evalSyntax(a)},b}(e);a.EqualList=n;var o=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.evalSyntax=function(b){if(this.list[1].type===a.Atom.VAR){var c=this.list[1].value,d=b.find(c).get(c);return d.evalSyntax(b)}return this.list[1].evalSyntax(b).evalSyntax(b)},c}(e);a.EvalList=o;var p=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.evalSyntax=function(b){var c=this.list[1].list,d=this.list[2];return new a.Fn(c,d,b)},c}(e);a.FnList=p;var q=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){return this.list[1].evalSyntax(a)>this.list[2].evalSyntax(a)},b}(e);a.GreaterList=q;var r=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){return this.list[1].evalSyntax(a)>=this.list[2].evalSyntax(a)},b}(e);a.GreaterEqualList=r;var s=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){this.assert();var b=this.list[1],c=this.list[2],d=this.list[3];return b.evalSyntax(a)?c.evalSyntax(a):d.evalSyntax(a)},b.prototype.assert=function(){if(4!==this.list.length)throw new Error("InvalidArgumentException")},b}(e);a.IfList=s;var t=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){return this.list[1].evalSyntax(a)<this.list[2].evalSyntax(a)},b}(e),u=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){return this.list[1].evalSyntax(a)<=this.list[2].evalSyntax(a)},b}(e),v=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.evalSyntax=function(b){for(var c=this.list[1].list,d=this.list[2],e=new a.DictEnv(b),f=0;f<c.length;f+=2)e.update(c[f].value,c[f+1].evalSyntax(e));return d.evalSyntax(e)},c}(e),w=function(b){function c(c,d,e){b.call(this,c,d,e),this.listColor=new a.Color(50,0,0,.2)}return __extends(c,b),c.prototype.evalSyntax=function(a){for(var b=0,c=1;c<this.list.length;c++)1===c?b=this.list[c].evalSyntax(a):b-=this.list[c].evalSyntax(a);return b},c}(e);a.MinusList=w;var x=function(b){function c(c,d,e){b.call(this,c,d,e),this.listColor=new a.Color(0,200,50,.2)}return __extends(c,b),c.prototype.evalSyntax=function(a){for(var b=1,c=1;c<this.list.length;c++)b*=this.list[c].evalSyntax(a);return b},c}(e),y=(function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){var b=this.list[0].evalSyntax(a),c=this.list[0].slice(1);return b.exec(c,a)},b}(e),function(b){function c(c,d,e){b.call(this,c,d,e),this.listColor=new a.Color(255,0,0,.2)}return __extends(c,b),c.prototype.evalSyntax=function(a){for(var b=0,c=1;c<this.list.length;c++)b+=this.list[c].evalSyntax(a);return b},c}(e));a.PlusList=y;var z=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.evalSyntax=function(b){return this.assert(),new a.Point(this.list[1].evalSyntax(b),this.list[2].evalSyntax(b))},c.prototype.assert=function(){if(void 0===this.list[1]||void 0===this.list[2]||this.list.length>3)throw"point arguments are illegal."},c}(e),A=function(b){function c(c,d,e){b.call(this,c,d,e),this.listColor=new a.Color(0,100,0,.2)}return __extends(c,b),c.prototype.evalSyntax=function(){this.assert();var b=this.list[1];return new a.Quote(b)},c.prototype.assert=function(){if(this.list[0].type!==a.Atom.QUOTE)throw new Error("InvalidAtomTypeException")},c}(e),B=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){this.assert();var b=this.list[1].evalSyntax(a),c=this.list[2].value,d=this.list.slice(3).map(function(b){return b.evalSyntax(a)});return b[c].apply(b,d),b},b.prototype.assert=function(){},b}(e),C=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.evalSyntax=function(a){this.assert();var c;c=this.list[0]instanceof b?this.list[0].evalSyntax(a):a.find(this.list[0].value).get(this.list[0].value);for(var d=this.list.slice(1),e=0;e<d.length;e++)c.env.dict[c.args[e].value]=d[e].evalSyntax(a);return c.evalSyntax(a)},b.prototype.assert=function(){},b}(e),D=function(){function a(a){"undefined"==typeof a&&(a=null),this.tokenizedList=[],a&&this.add(a)}return a.prototype.add=function(a){this.tokenizedList=this.tokenizedList.concat(H.tokenize(a))},a.prototype.next=function(){return 0===this.tokenizedList.length?null:this.tokenizedList.shift()},a}();a.TokenReader=D;var E=function(){function a(a){this.add=function(a){this._list.push(a),this._socket.send("hoge")},this._list=[],this._socket=a}return a.prototype.remove=function(a){for(var b in this._list)this._list[b]==a&&this._list.splice(b,1),this._list[b]instanceof e&&this._list[b].remove(a)},a.prototype.clear=function(){this._list=[]},a.prototype.draw=function(a){for(var b=0;b<this._list.length;b++)this._list[b].rotate&&this._list[b].rotate(.01),this._list[b].draw(a)},a.prototype.getDrawing=function(a,b){for(var c in this._list){var d=this._list[c];if(d.isMet(a)&&d!==b)return d}},a.prototype.getListObject=function(a,b){for(var c in this._list){var d=this._list[c],e=d.getListObject(a);if(e&&e!==b)return e}},a}(),F=function(){function a(){var a=new WebSocket("ws://localhost:5000");a.onopen=function(){console.log("web socket connection is established.")},a.onmessage=function(a){console.log(a.data)},this.socket=a}return a.prototype.send=function(a){this.socket.send(a)},a}(),G=function(){function b(){}return b.env=new a.DictEnv(null),b.tokenReader=new D,b.graphicContext=null,b.socket=new F,b.drawingManager=new E(b.socket),b.lastClickedPoint=null,b.drugging=!1,b.clickPoint=new a.Point(0,0),b.event=null,b}();a.Global=G;var H=function(){function b(){}return b.tokenize=function(a){return a.split("(").join(" ( ").split(")").join(" ) ").split(" ").filter(function(a){return a?!0:!1}).map(function(a){var b=parseFloat(a);return isNaN(b)?a:b})},b.atomize=function(b){if(b===a.Atom.TRUE)return new a.Atom(a.Atom.TRUE);if(b===a.Atom.FALSE)return new a.Atom(a.Atom.FALSE);if("string"==typeof b)return'"'===b[0]||"'"===b[0]?new a.Atom(a.Atom.STR,b.slice(1,-1)):a.Atom.isAtomToken(b)?new a.Atom(b,null):new a.Atom(a.Atom.VAR,b);if("number"==typeof b)return new a.Atom(a.Atom.NUMBER,b);throw"Unknown token"},b.parse=function(c,d){"undefined"==typeof d&&(d=null);for(var e=[];;){var f,g=c.next();if(d)f=null;else{var h=200*Math.random(),i=200*Math.random();f=new a.Point(Math.floor(h),Math.floor(i))}if("("===g)e.push(b.parse(c,d));else{if(")"===g)return b.createList(e,d,f);if(null===g)break;e.push(b.atomize(g))}}return e[0]},b.createList=function(b,c,d){var e=b[0],D={};D[a.Atom.FN]=p,D[a.Atom.IF]=s,D[a.Atom.DEF]=i,D[a.Atom.DEFN]=j,D[a.Atom.DO]=l,D[a.Atom.SEND]=B,D[a.Atom.LET]=v,D[a.Atom.QUOTE]=A,D[a.Atom.EVAL]=o,D[a.Atom.PLUS]=y,D[a.Atom.MINUS]=w,D[a.Atom.DIV]=k,D[a.Atom.MUL]=x,D[a.Atom.EQUAL]=n,D[a.Atom.GREATER]=q,D[a.Atom.LESS]=t,D[a.Atom.GREATEREQUAL]=r,D[a.Atom.LESSEQUAL]=u,D[a.Atom.DRAW]=m,D[a.Atom.POINT]=z,D[a.Atom.COLOR]=h,D[a.Atom.CIRCLE]=f,D[a.Atom.CLEAR]=g;var E=D[e.type];return E||(E=C),new E(b,c,d)},b.parseAndEval=function(c,d){d||(d=new a.DictEnv(null));var e=b.parse(c);return e.evalSyntax(d)},b.readAndEval=function(a,c){return G.tokenReader.add(a),b.parseAndEval(G.tokenReader,c)},b.createContextWrapper=function(b){var c=document.getElementById(b);return c&&c.getContext?new a.ContextWrapper(c.getContext("2d")):null},b}();a.Core=H;var I=function(){function a(a,b){this.commandContainer=$(a),this.callbackList=b,$("#emola-console").append(this.commandContainer),this.commandContainer.console({promptLabel:"Emola> ",commandValidate:function(a){return""!==a},commandHandle:this.callbackList,autofocus:!0,animateScroll:!0,promptHistory:!0,charInsertTrigger:function(){return!0}})}return a.prototype.addCallback=function(a){this.callbackList=a},a}();d.Front={},$(document).ready(function(){null===G.graphicContext&&(G.graphicContext=H.createContextWrapper("canvas"),null!==G.graphicContext&&d.Front.drawLoop());new I('<div class="console">',function(a){var b="";try{G.tokenReader.add(a);var c=H.parse(G.tokenReader);c.draw&&G.drawingManager.add(c),b=c.evalSyntax(G.env)}catch(d){b="Parse error",console.log(d)}return[{msg:"=> "+b,className:"jquery-console-message-value"}]})});{var J=function(){function a(){!function(){var a=null;$(window).mousedown(function(c){G.drugging=!0;var d=b(null,c);d&&(a=d)}),$(window).mouseup(function(c){if(G.drugging=!1,a){var d=b(a,c);d&&a!=d&&d.add(a),a=null}}),$(window).mousemove(function(b){a&&(a.point=c(b))})}()}return a}();new J}d.Front.drawLoop=function(){setTimeout(d.Front.drawLoop,15),G.graphicContext.clear(),G.drawingManager.draw(G.graphicContext)}}(emola||(emola={}));